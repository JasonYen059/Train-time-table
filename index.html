<!DOCTYPE html>
<html>
<head>
  <link rel="shortcut icon" href="#">
  <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
      crossorigin="anonymous"
    ></script>
    <title>Train Time App</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    
    <style type="text/css">
    *{
      margin: 0;
      padding: 0;
      font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      box-sizing: border-box;
    }

    body {
    background: linear-gradient(120deg, rgb(255, 187, 0), #ca2f00);
    color: rgb(66, 66, 66);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

    #timeApp{
      width: 400px;
      height: 450px;
      border-radius: 15px;
      border: none;
      background-color: #dfdfdf;
    }

    #title{
      width: 100%;
      height: 80px;
      background-color: rgb(255, 255, 255);
      border-bottom: 2px solid #ff9531;
      border-radius: 10px 10px 0 0 ;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #title img{
      width: 53%;
      height: auto;
      margin: auto;
    }

   

    #container {
      width: 350px;
      height: 330px;
      background-color: #ffffff;
      border: none;
      margin: 20px auto;
      padding: 8px;
      border-radius: 10px;
    }

    #container span{
      font-size: 25px;
    }

   #fromWhere, #toWhere {
     width: 100px;
     height: 30px;
     font-size: 20px;
     margin: auto;
     outline: none;
     border-radius: 5px;
     cursor: pointer;
   }


   .setLocation {
     width: 300px;
     height: 60px;
     margin: auto;
     border-bottom: 2px solid rgb(102, 101, 101);
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 10px 10px 0 0 ;
   }

   .dateContainer ,.timeContainer, .seatTypeContainer,.confirmDiv{
    margin: 10px auto;
    width: 250px;
    height: 50px;
    font-size: 25px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-bottom: 1px solid #dfdfdf;
   }

   .confirmDiv{
     border: none;
     height: 60px;
   }

   #chosenDate ,#chosenTime, #seatType{
     margin: auto;
     width: 250px;
     height: 35px;
     font-size: 18px;
     background-color: white;
     border: none;
     text-align: center;
     border-radius: 5px;
     outline: none;
     transition: 0.5s ease;
     cursor: pointer;
   }

   

   #confirm{
     width: 200px;
     height: 30px;
     font-size: 18px;
     border: none;
     transition: 0.5s ease;
     cursor: pointer;
     background-color:#ff944d ;
     border-radius: 5px;
     color: white;
   }

   #confirm:hover {
     box-shadow: 2px 2px rgb(139, 139, 139);
     background-color:#ff822e ;
   }

   select{
     text-align-last: center;
   }

   
   #timeTable{
     width: 300px;
     height: 350px;
     margin-top: 10px;
   }

   
/* ------------------------------------------------------------------------- */
   #showInfo{
    width: 400px;
    height: 600px;
    border-radius: 15px;
    border: none;
    background-color: #dfdfdf;
    display: none;
   }



   #infoTitle {
    height: 40px;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    border-radius: 10px 10px 0 0;
    color: white;
    background-color: white;
    position: relative;
    background-color: rgb(102, 101, 101);
   }

   #info {
      width: 100%;
      height: 560px;
      background-color: #f5f5f5;
      border: none;
      border-radius: 10px;
      overflow: auto;
    }

    #infoBack{
      position: absolute;
      left: 20px;
      cursor: pointer;
      transition: 0.3s;
    }

    #infoBack:hover{
     font-size: 25px;
    }

    .infoTable{
      width: 325px;
      height: 100px;
     background-color: white;
      border-radius: 10px;
      margin: 10px auto;
      box-shadow: 2px 2px rgb(56, 56, 56);
    }

    .timeInfo , .numPriceInfo{
      width: 325px;
      height: 50px;
      font-size: 20px;
      padding: 10px;
      display: flex;
    justify-content:space-between;
    align-items: center;
    }

    .timeInfo{
      border-radius: 10px 10px 0 0;
      background-color:#ffbc65 ;
    }


    .timeFrom, .timeTo , .toIcon, .num , .price{
      width: 100px;
      text-align:center ;
    }

    .numPriceInfo{
      border-top: 2px solid #bdbdbd;
    }


    #trainNumTime {
     list-style: none;
     width: 100%;
    height: 300px;
    overflow: auto;
   }

    </style>    
</head>
 
  

<body>
  <div id="timeApp">
    <div id="title"><img src="Logo.svg">
      
    </div>
    
     <div id="container">
       <div class="setLocation">
       <select id="fromWhere" >
        <option value="" disabled selected>出發</option> 
       </select>
       <span><i class="fas fa-long-arrow-alt-right"></i></span>
       <select id="toWhere" >
        <option value="" disabled selected>目的地</option>
      </select>
       </div>


       <div class="dateContainer">
        <p><i class="far fa-calendar-alt"></i></p>
        <input id="chosenDate" value ="123" >
       </div>

       <div class="timeContainer">
        <p><i class="far fa-clock"></i></p>
        <select name="time" id="chosenTime">
          <option value="">14 : 25</option>
          <option value="">14 : 40</option>
          <option value="">15 : 25</option>
          <option value="">15 : 40</option>
        </select>
       </div>

       <div class="seatTypeContainer">
        <p><i class="fas fa-train"></i></p>
        <select name="seatType" id="seatType">
          <option value="" disabled selected>車廂種類</option>
          <option value="0">商務車廂</option>
          <option value="1">標準車廂</option>
          <option value="2">自由座車廂</option>
        </select>
       </div>

       <div class="confirmDiv">
        <button id="confirm">查 詢</button>
       </div>
     </div>
    </div>


    <div id="showInfo">
      <div id="infoTitle">
        <span id="infoBack"><i class="fas fa-chevron-left"></i></span>
        <p id="infoDate"></p>
      </div>
      <div id="info">
        <!-- <div class="infoTable">
          <div class="timeInfo">
            <span class="timeFrom">15:20</span>
            <span class="toIcon"><i class="fas fa-long-arrow-alt-right"></i></span>
            <span class="timeTo">17:50</span>
          </div>

          <div class="numPriceInfo">
            <span class="num">車次 808</span>
            <span class="price">$760</span>
          </div>
        </div> -->
      </div>
    </div>
        

    <script type="text/javascript">
    var today = new Date();
    $("#chosenDate").val(`${today.getFullYear()}-0${today.getMonth()+1}-${today.getDate()}`);
   
    
    var options = [];
    let start = $("#fromWhere").val();
    let end = $("#toWhere").val();
    let dateControl = $("#chosenDate").val();

    var stationRequest = new XMLHttpRequest();
    stationRequest.open('Get',`https://ptx.transportdata.tw/MOTC/v2/Rail/THSR/Station?$format=JSON`);
    stationRequest.send();
    stationRequest.onload=function() {
    let stationData = JSON.parse(this.responseText);

    stationData.forEach((e,i)=>{
      let num = stationData[i].StationID;
      let stationName = stationData[i].StationName.Zh_tw;
      options.push({name:`${stationName}`,number:`${num}`});
      $("#fromWhere").append(`<option value="${options[i].number}">${options[i].name}</option>`);
      $("#toWhere").append(`<option value="${options[i].number}">${options[i].name}</option>`);
    });
    console.log(options);
    }

   
    let fakeData =[{
    "TrainDate":"2021-04-09",
    "DailyTrainInfo":{"TrainNo":"0803","Direction":0,"StartingStationID":"0990","StartingStationName":{"Zh_tw":"南港","En":"Nangang"},"EndingStationID":"1070","EndingStationName":{"Zh_tw":"左營","En":"Zuoying"},"Note":{}},
    "OriginStopTime":{"StopSequence":1,"StationID":"0990","StationName":{"Zh_tw":"南港","En":"Nangang"},"ArrivalTime":"06:15","DepartureTime":"06:15"},
    "DestinationStopTime":{"StopSequence":12,"StationID":"1070","StationName":{"Zh_tw":"左營","En":"Zuoying"},"ArrivalTime":"08:40","DepartureTime":"08:40"},
    "UpdateTime":"2021-02-09T00:00:00+08:00","VersionID":1}
    
    ,{"TrainDate":"2021-04-09","DailyTrainInfo":{"TrainNo":"0603","Direction":0,"StartingStationID":"0990","StartingStationName":{"Zh_tw":"南港","En":"Nangang"},"EndingStationID":"1070","EndingStationName":{"Zh_tw":"左營","En":"Zuoying"},"Note":{}},"OriginStopTime":{"StopSequence":1,"StationID":"0990","StationName":{"Zh_tw":"南港","En":"Nangang"},"ArrivalTime":"06:40","DepartureTime":"06:40"},"DestinationStopTime":{"StopSequence":9,"StationID":"1070","StationName":{"Zh_tw":"左營","En":"Zuoying"},"ArrivalTime":"08:50","DepartureTime":"08:50"},"UpdateTime":"2021-02-09T00:00:00+08:00","VersionID":1}
    
    ,{"TrainDate":"2021-04-09","DailyTrainInfo":{"TrainNo":"0805","Direction":0,"StartingStationID":"0990","StartingStationName":{"Zh_tw":"南港","En":"Nangang"},"EndingStationID":"1070","EndingStationName":{"Zh_tw":"左營","En":"Zuoying"},"Note":{}},"OriginStopTime":{"StopSequence":1,"StationID":"0990","StationName":{"Zh_tw":"南港","En":"Nangang"},"ArrivalTime":"07:00","DepartureTime":"07:00"},"DestinationStopTime":{"StopSequence":12,"StationID":"1070","StationName":{"Zh_tw":"左營","En":"Zuoying"},"ArrivalTime":"09:25","DepartureTime":"09:25"},"UpdateTime":"2021-02-09T00:00:00+08:00","VersionID":1}
    
    ,{"TrainDate":"2021-04-09","DailyTrainInfo":{"TrainNo":"0109","Direction":0,"StartingStationID":"0990","StartingStationName":{"Zh_tw":"南港","En":"Nangang"},"EndingStationID":"1070","EndingStationName":{"Zh_tw":"左營","En":"Zuoying"},"Note":{}},"OriginStopTime":{"StopSequence":1,"StationID":"0990","StationName":{"Zh_tw":"南港","En":"Nangang"},"ArrivalTime":"07:20","DepartureTime":"07:20"},"DestinationStopTime":{"StopSequence":5,"StationID":"1070","StationName":{"Zh_tw":"左營","En":"Zuoying"},"ArrivalTime":"09:05","DepartureTime":"09:05"},"UpdateTime":"2021-02-09T00:00:00+08:00","VersionID":1}
    
    ,{"TrainDate":"2021-04-09","DailyTrainInfo":{"TrainNo":"0609","Direction":0,"StartingStationID":"0990","StartingStationName":{"Zh_tw":"南港","En":"Nangang"},"EndingStationID":"1070","EndingStationName":{"Zh_tw":"左營","En":"Zuoying"},"Note":{}},"OriginStopTime":{"StopSequence":1,"StationID":"0990","StationName":{"Zh_tw":"南港","En":"Nangang"},"ArrivalTime":"07:35","DepartureTime":"07:35"},"DestinationStopTime":{"StopSequence":9,"StationID":"1070","StationName":{"Zh_tw":"左營","En":"Zuoying"},"ArrivalTime":"09:45","DepartureTime":"09:45"},"UpdateTime":"2021-02-09T00:00:00+08:00","VersionID":1}]

    let fakePrice=[
    {"OriginStationID":"0990","OriginStationName":{"Zh_tw":"南港","En":"Nangang"},"DestinationStationID":"1070","DestinationStationName":{"Zh_tw":"左營","En":"Zuoying"},"Direction":0,"Fares":[{"TicketType":"商務","Price":2500.0},{"TicketType":"標準","Price":1530.0},{"TicketType":"自由","Price":1480.0}],"SrcUpdateTime":"2020-07-23T09:13:41+08:00","UpdateTime":"2020-07-24T06:49:13+08:00","VersionID":5}
    ]


  $("#confirm").click((event)=>{
      event.preventDefault();
      let start = $("#fromWhere").val();
      let end = $("#toWhere").val();
      let dateControl = $("#chosenDate").val();

      $("#infoDate").text(dateControl);

    //   var ourRequest = new XMLHttpRequest();
    // ourRequest.open('Get',`https://ptx.transportdata.tw/MOTC/v2/Rail/THSR/DailyTimetable/OD/${start}/to/${end}/${dateControl}?$format=JSON`);
    // ourRequest.send();
    // ourRequest.onload=function() {
    //   let data = JSON.parse(this.responseText);
    //   console.log(data);
      
    $(".infoTable").remove();
    fakeData.forEach((e,i)=>{
        let trainNo = fakeData[i].DailyTrainInfo.TrainNo;
        let arriveTimeA = fakeData[i].OriginStopTime.ArrivalTime;
        let arriveTimeB = fakeData[i].DestinationStopTime.ArrivalTime;
        let seatType = $("#seatType").val();
        let thsrPrice = fakePrice[0].Fares[seatType].Price;
        $("#info").append(`
        <div class="infoTable">
        <div class="timeInfo">
            <span class="timeFrom">${arriveTimeA}</span>
            <span class="toIcon"><i class="fas fa-long-arrow-alt-right"></i></span>
            <span class="timeTo">${arriveTimeB}</span>
        </div>
        <div class="numPriceInfo">
            <span class="num">車次 ${trainNo}</span>
            <span class="price">$${thsrPrice}</span>
        </div>
      </div>`);
      });
    // }
      $("#timeApp").hide();
      $("#showInfo").show();

    let priceDataArr = [];
    var priceRequest = new XMLHttpRequest();
    priceRequest.open('Get',`https://ptx.transportdata.tw/MOTC/v2/Rail/THSR/ODFare/${start}/to/${end}?$format=JSON`);
    priceRequest.send();
    priceRequest.onload=function() {
      let priceData = JSON.parse(this.responseText);
      let seatType = $("#seatType").val();
      let thsrPrice = priceData[0].Fares[seatType].Price;
      priceDataArr.push({money:`${stationName}`});
    }
    console.log(priceDataArr);
    
  });

    // function test(data){
    //   let seatType = $("#seatType").val();
    //   let thsrPrice = data[0].Fares[seatType].Price;
    
    //   console.log(data);
    // };



    $("#infoBack").click((event)=>{
      event.preventDefault;
      $("#timeApp").show();
      $("#showInfo").hide();
    })


    $(function(){
        $("#chosenDate").datepicker({
          dateFormat:"yy-mm-dd"
        });
      });
    
   

      


    </script>
</body>
</html>